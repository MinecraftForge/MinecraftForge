--- ../src_base/minecraft/net/minecraft/item/crafting/ShapedRecipes.java
+++ ../src_work/minecraft/net/minecraft/item/crafting/ShapedRecipes.java
@@ -1,12 +1,14 @@
 package net.minecraft.item.crafting;
+
+import java.util.Iterator;
 
 import net.minecraft.inventory.InventoryCrafting;
 import net.minecraft.item.ItemStack;
+import net.minecraft.nbt.NBTBase;
 import net.minecraft.nbt.NBTTagCompound;
 import net.minecraft.world.World;
 
-public class ShapedRecipes implements IRecipe
-{
+public class ShapedRecipes implements IRecipe {
     /** How many horizontal slots this recipe is wide. */
     public final int recipeWidth;
 
@@ -104,11 +106,42 @@
                     {
                         return false;
                     }
+
+                    if (itemstack.getTagCompound() != null)
+                    {
+                        if (itemstack1.getTagCompound() == null || !compareNBTTags(itemstack.getTagCompound(), itemstack1.getTagCompound()))
+                        {
+                            return false;
+                        }
+                    }
                 }
             }
         }
 
         return true;
+    }
+
+    private boolean compareNBTTags(NBTTagCompound tagCompound, NBTTagCompound tagCompound2)
+    {
+        Iterator iterator = tagCompound.getTags().iterator();
+        while (iterator.hasNext())
+        {
+            NBTBase childCompound = (NBTBase) iterator.next();
+
+            if (!(childCompound instanceof NBTTagCompound && tagCompound2.hasKey(childCompound.getName())))
+            {
+                return childCompound.equals(tagCompound2.getTag(childCompound.getName()));
+            }
+            else if (!tagCompound2.hasKey(childCompound.getName())
+                    || !compareNBTTags((NBTTagCompound) childCompound, (NBTTagCompound) tagCompound2.getTag(childCompound.getName())))
+            {
+
+                return false;
+            }
+        }
+
+        return true;
+
     }
 
     /**
@@ -126,7 +159,7 @@
 
                 if (itemstack1 != null && itemstack1.hasTagCompound())
                 {
-                    itemstack.setTagCompound((NBTTagCompound)itemstack1.stackTagCompound.copy());
+                    itemstack.setTagCompound((NBTTagCompound) itemstack1.stackTagCompound.copy());
                 }
             }
         }
