--- ../src_base/minecraft/net/minecraft/item/crafting/ShapelessRecipes.java
+++ ../src_work/minecraft/net/minecraft/item/crafting/ShapelessRecipes.java
@@ -3,6 +3,7 @@
 import java.util.ArrayList;
 import java.util.Iterator;
 import java.util.List;
+
 import net.minecraft.inventory.InventoryCrafting;
 import net.minecraft.item.ItemStack;
 import net.minecraft.world.World;
@@ -48,11 +49,25 @@
                     {
                         ItemStack itemstack1 = (ItemStack)iterator.next();
 
-                        if (itemstack.itemID == itemstack1.itemID && (itemstack1.getItemDamage() == 32767 || itemstack.getItemDamage() == itemstack1.getItemDamage()))
+                        if (itemstack.itemID == itemstack1.itemID
+                                && (itemstack1.getItemDamage() == Short.MAX_VALUE || itemstack.getItemDamage() == itemstack1.getItemDamage()))
                         {
-                            flag = true;
-                            arraylist.remove(itemstack1);
-                            break;
+                            if (itemstack1.getTagCompound() != null)
+                            {
+                                if (itemstack.getTagCompound() != null && itemstack1.getTagCompound().equals(itemstack.getTagCompound()))
+                                {
+                                    flag = true;
+                                    arraylist.remove(itemstack1);
+                                    break;
+                                }
+                            }
+                            else
+                            {
+                                // Vanilla
+                                flag = true;
+                                arraylist.remove(itemstack1);
+                                break;
+                            }
                         }
                     }
 
