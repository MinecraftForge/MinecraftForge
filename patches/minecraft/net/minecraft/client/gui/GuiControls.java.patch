--- a/net/minecraft/client/gui/GuiControls.java
+++ b/net/minecraft/client/gui/GuiControls.java
@@ -36,7 +36,7 @@
       this.buttonReset = this.addButton(new GuiButton(201, this.width / 2 - 155, this.height - 29, 150, 20, I18n.format("controls.resetAll")) {
          public void func_194829_a(double p_194829_1_, double p_194829_3_) {
             for(KeyBinding keybinding : GuiControls.this.mc.gameSettings.keyBindings) {
-               keybinding.func_197979_b(keybinding.func_197977_i());
+               keybinding.setToDefault();
             }
 
             KeyBinding.resetKeyBindingArrayAndHash();
@@ -89,11 +89,14 @@
    public boolean keyPressed(int p_keyPressed_1_, int p_keyPressed_2_, int p_keyPressed_3_) {
       if (this.buttonId != null) {
          if (p_keyPressed_1_ == 256) {
+            this.buttonId.setKeyModifierAndCode(net.minecraftforge.client.settings.KeyModifier.getActiveModifier(), InputMappings.field_197958_a);
             this.options.func_198014_a(this.buttonId, InputMappings.field_197958_a);
          } else {
+            this.buttonId.setKeyModifierAndCode(net.minecraftforge.client.settings.KeyModifier.getActiveModifier(), InputMappings.func_197954_a(p_keyPressed_1_, p_keyPressed_2_));
             this.options.func_198014_a(this.buttonId, InputMappings.func_197954_a(p_keyPressed_1_, p_keyPressed_2_));
          }
 
+         if (!net.minecraftforge.client.settings.KeyModifier.isKeyCodeModifier(this.buttonId.getKey()))
          this.buttonId = null;
          this.time = Util.func_211177_b();
          KeyBinding.resetKeyBindingArrayAndHash();
