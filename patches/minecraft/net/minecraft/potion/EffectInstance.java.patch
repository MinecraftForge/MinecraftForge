--- a/net/minecraft/potion/EffectInstance.java
+++ b/net/minecraft/potion/EffectInstance.java
@@ -8,224 +8,308 @@
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 
-public class EffectInstance implements Comparable<EffectInstance> {
-   private static final Logger field_180155_a = LogManager.getLogger();
-   private final Effect field_188420_b;
-   private int field_76460_b;
-   private int field_76461_c;
-   private boolean field_82723_d;
-   private boolean field_82724_e;
-   @OnlyIn(Dist.CLIENT)
-   private boolean field_100013_f;
-   private boolean field_188421_h;
-   private boolean field_205349_i;
+public class EffectInstance
+		implements Comparable<EffectInstance>, net.minecraftforge.common.extensions.IForgeEffectInstance {
+	private static final Logger field_180155_a = LogManager.getLogger();
+	private final java.util.function.Supplier<Effect> field_188420_b;
+	private int field_76460_b;
+	private int field_76461_c;
+	private boolean field_82723_d;
+	private boolean field_82724_e;
+	@OnlyIn(Dist.CLIENT)
+	private boolean field_100013_f;
+	private boolean field_188421_h;
+	private boolean field_205349_i;
+	
+	public EffectInstance(java.util.function.Supplier<Effect> potionIn) {
+		this(potionIn, 0, 0);
+	}
 
-   public EffectInstance(Effect p_i46811_1_) {
-      this(p_i46811_1_, 0, 0);
-   }
+	// Forge: Use the other constructor that takes a Supplier
+	@Deprecated
+	public EffectInstance(Effect p_i46811_1_) {
+		this(p_i46811_1_, 0, 0);
+	}
+	
+	public EffectInstance(java.util.function.Supplier<Effect> potionIn, int durationIn) {
+		this(potionIn, durationIn, 0);
+	}
 
-   public EffectInstance(Effect p_i46812_1_, int p_i46812_2_) {
-      this(p_i46812_1_, p_i46812_2_, 0);
-   }
+	// Forge: Use the other constructor that takes a Supplier
+	@Deprecated
+	public EffectInstance(Effect p_i46812_1_, int p_i46812_2_) {
+		this(p_i46812_1_, p_i46812_2_, 0);
+	}
+	
+	public EffectInstance(java.util.function.Supplier<Effect> potionIn, int durationIn, int amplifierIn) {
+		this(potionIn, durationIn, amplifierIn, false, true);
+	}
 
-   public EffectInstance(Effect p_i46813_1_, int p_i46813_2_, int p_i46813_3_) {
-      this(p_i46813_1_, p_i46813_2_, p_i46813_3_, false, true);
-   }
+	// Forge: Use the other constructor that takes a Supplier
+	@Deprecated
+	public EffectInstance(Effect p_i46813_1_, int p_i46813_2_, int p_i46813_3_) {
+		this(p_i46813_1_, p_i46813_2_, p_i46813_3_, false, true);
+	}
+	
+	public EffectInstance(java.util.function.Supplier<Effect> potionIn, int durationIn, int amplifierIn, boolean ambientIn,
+			boolean showParticlesIn) {
+		this(potionIn, durationIn, amplifierIn, ambientIn, showParticlesIn, showParticlesIn);
+	}
 
-   public EffectInstance(Effect p_i46814_1_, int p_i46814_2_, int p_i46814_3_, boolean p_i46814_4_, boolean p_i46814_5_) {
-      this(p_i46814_1_, p_i46814_2_, p_i46814_3_, p_i46814_4_, p_i46814_5_, p_i46814_5_);
-   }
+	// Forge: Use the other constructor that takes a Supplier
+	@Deprecated
+	public EffectInstance(Effect p_i46814_1_, int p_i46814_2_, int p_i46814_3_, boolean p_i46814_4_,
+			boolean p_i46814_5_) {
+		this(p_i46814_1_, p_i46814_2_, p_i46814_3_, p_i46814_4_, p_i46814_5_, p_i46814_5_);
+	}
 
-   public EffectInstance(Effect p_i48980_1_, int p_i48980_2_, int p_i48980_3_, boolean p_i48980_4_, boolean p_i48980_5_, boolean p_i48980_6_) {
-      this.field_188420_b = p_i48980_1_;
-      this.field_76460_b = p_i48980_2_;
-      this.field_76461_c = p_i48980_3_;
-      this.field_82724_e = p_i48980_4_;
-      this.field_188421_h = p_i48980_5_;
-      this.field_205349_i = p_i48980_6_;
-   }
+	public EffectInstance(java.util.function.Supplier<Effect> potionIn, int durationIn, int amplifierIn,
+			boolean ambientIn, boolean showParticlesIn, boolean showIconIn) {
+		this.field_188420_b = potionIn;
+		this.field_76460_b = durationIn;
+		this.field_76461_c = amplifierIn;
+		this.field_82724_e = ambientIn;
+		this.field_188421_h = showParticlesIn;
+		this.field_205349_i = showIconIn;
+	}
 
-   public EffectInstance(EffectInstance p_i1577_1_) {
-      this.field_188420_b = p_i1577_1_.field_188420_b;
-      this.field_76460_b = p_i1577_1_.field_76460_b;
-      this.field_76461_c = p_i1577_1_.field_76461_c;
-      this.field_82724_e = p_i1577_1_.field_82724_e;
-      this.field_188421_h = p_i1577_1_.field_188421_h;
-      this.field_205349_i = p_i1577_1_.field_205349_i;
-   }
+	// Forge: Use the other constructor that takes a Supplier
+	@Deprecated
+	public EffectInstance(Effect p_i48980_1_, int p_i48980_2_, int p_i48980_3_, boolean p_i48980_4_,
+			boolean p_i48980_5_, boolean p_i48980_6_) {
+		this.field_188420_b = () -> p_i48980_1_;
+		this.field_76460_b = p_i48980_2_;
+		this.field_76461_c = p_i48980_3_;
+		this.field_82724_e = p_i48980_4_;
+		this.field_188421_h = p_i48980_5_;
+		this.field_205349_i = p_i48980_6_;
+	}
 
-   public boolean func_199308_a(EffectInstance p_199308_1_) {
-      if (this.field_188420_b != p_199308_1_.field_188420_b) {
-         field_180155_a.warn("This method should only be called for matching effects!");
-      }
+	public EffectInstance(EffectInstance p_i1577_1_) {
+		this.field_188420_b = p_i1577_1_.field_188420_b;
+		this.field_76460_b = p_i1577_1_.field_76460_b;
+		this.field_76461_c = p_i1577_1_.field_76461_c;
+		this.field_82724_e = p_i1577_1_.field_82724_e;
+		this.field_188421_h = p_i1577_1_.field_188421_h;
+		this.field_205349_i = p_i1577_1_.field_205349_i;
+		this.curativeItems = p_i1577_1_.curativeItems == null ? null
+				: new java.util.ArrayList<net.minecraft.item.ItemStack>(p_i1577_1_.curativeItems);
+	}
 
-      boolean flag = false;
-      if (p_199308_1_.field_76461_c > this.field_76461_c) {
-         this.field_76461_c = p_199308_1_.field_76461_c;
-         this.field_76460_b = p_199308_1_.field_76460_b;
-         flag = true;
-      } else if (p_199308_1_.field_76461_c == this.field_76461_c && this.field_76460_b < p_199308_1_.field_76460_b) {
-         this.field_76460_b = p_199308_1_.field_76460_b;
-         flag = true;
-      }
+	public boolean func_199308_a(EffectInstance p_199308_1_) {
+		if (this.field_188420_b != p_199308_1_.field_188420_b) {
+			field_180155_a.warn("This method should only be called for matching effects!");
+		}
 
-      if (!p_199308_1_.field_82724_e && this.field_82724_e || flag) {
-         this.field_82724_e = p_199308_1_.field_82724_e;
-         flag = true;
-      }
+		boolean flag = false;
+		if (p_199308_1_.field_76461_c > this.field_76461_c) {
+			this.field_76461_c = p_199308_1_.field_76461_c;
+			this.field_76460_b = p_199308_1_.field_76460_b;
+			flag = true;
+		} else if (p_199308_1_.field_76461_c == this.field_76461_c && this.field_76460_b < p_199308_1_.field_76460_b) {
+			this.field_76460_b = p_199308_1_.field_76460_b;
+			flag = true;
+		}
 
-      if (p_199308_1_.field_188421_h != this.field_188421_h) {
-         this.field_188421_h = p_199308_1_.field_188421_h;
-         flag = true;
-      }
+		if (!p_199308_1_.field_82724_e && this.field_82724_e || flag) {
+			this.field_82724_e = p_199308_1_.field_82724_e;
+			flag = true;
+		}
 
-      if (p_199308_1_.field_205349_i != this.field_205349_i) {
-         this.field_205349_i = p_199308_1_.field_205349_i;
-         flag = true;
-      }
+		if (p_199308_1_.field_188421_h != this.field_188421_h) {
+			this.field_188421_h = p_199308_1_.field_188421_h;
+			flag = true;
+		}
 
-      return flag;
-   }
+		if (p_199308_1_.field_205349_i != this.field_205349_i) {
+			this.field_205349_i = p_199308_1_.field_205349_i;
+			flag = true;
+		}
 
-   public Effect func_188419_a() {
-      return this.field_188420_b;
-   }
+		return flag;
+	}
 
-   public int func_76459_b() {
-      return this.field_76460_b;
-   }
+	public Effect func_188419_a() {
+		return this.field_188420_b == null ? null : this.field_188420_b.get();
+	}
 
-   public int func_76458_c() {
-      return this.field_76461_c;
-   }
+	public int func_76459_b() {
+		return this.field_76460_b;
+	}
 
-   public boolean func_82720_e() {
-      return this.field_82724_e;
-   }
+	public int func_76458_c() {
+		return this.field_76461_c;
+	}
 
-   public boolean func_188418_e() {
-      return this.field_188421_h;
-   }
+	public boolean func_82720_e() {
+		return this.field_82724_e;
+	}
 
-   public boolean func_205348_f() {
-      return this.field_205349_i;
-   }
+	public boolean func_188418_e() {
+		return this.field_188421_h;
+	}
 
-   public boolean func_76455_a(LivingEntity p_76455_1_) {
-      if (this.field_76460_b > 0) {
-         if (this.field_188420_b.func_76397_a(this.field_76460_b, this.field_76461_c)) {
-            this.func_76457_b(p_76455_1_);
-         }
+	public boolean func_205348_f() {
+		return this.field_205349_i;
+	}
 
-         this.func_76454_e();
-      }
+	public boolean func_76455_a(LivingEntity p_76455_1_) {
+		if (this.field_76460_b > 0) {
+			if (this.field_188420_b.get().func_76397_a(this.field_76460_b, this.field_76461_c)) {
+				this.func_76457_b(p_76455_1_);
+			}
 
-      return this.field_76460_b > 0;
-   }
+			this.func_76454_e();
+		}
 
-   private int func_76454_e() {
-      return --this.field_76460_b;
-   }
+		return this.field_76460_b > 0;
+	}
 
-   public void func_76457_b(LivingEntity p_76457_1_) {
-      if (this.field_76460_b > 0) {
-         this.field_188420_b.func_76394_a(p_76457_1_, this.field_76461_c);
-      }
+	private int func_76454_e() {
+		return --this.field_76460_b;
+	}
 
-   }
+	public void func_76457_b(LivingEntity p_76457_1_) {
+		if (this.field_76460_b > 0) {
+			this.field_188420_b.get().func_76394_a(p_76457_1_, this.field_76461_c);
+		}
 
-   public String func_76453_d() {
-      return this.field_188420_b.func_76393_a();
-   }
+	}
 
-   public String toString() {
-      String s;
-      if (this.field_76461_c > 0) {
-         s = this.func_76453_d() + " x " + (this.field_76461_c + 1) + ", Duration: " + this.field_76460_b;
-      } else {
-         s = this.func_76453_d() + ", Duration: " + this.field_76460_b;
-      }
+	public String func_76453_d() {
+		return this.field_188420_b.get().func_76393_a();
+	}
 
-      if (this.field_82723_d) {
-         s = s + ", Splash: true";
-      }
+	public String toString() {
+		String s;
+		if (this.field_76461_c > 0) {
+			s = this.func_76453_d() + " x " + (this.field_76461_c + 1) + ", Duration: " + this.field_76460_b;
+		} else {
+			s = this.func_76453_d() + ", Duration: " + this.field_76460_b;
+		}
 
-      if (!this.field_188421_h) {
-         s = s + ", Particles: false";
-      }
+		if (this.field_82723_d) {
+			s = s + ", Splash: true";
+		}
 
-      if (!this.field_205349_i) {
-         s = s + ", Show Icon: false";
-      }
+		if (!this.field_188421_h) {
+			s = s + ", Particles: false";
+		}
 
-      return s;
-   }
+		if (!this.field_205349_i) {
+			s = s + ", Show Icon: false";
+		}
 
-   public boolean equals(Object p_equals_1_) {
-      if (this == p_equals_1_) {
-         return true;
-      } else if (!(p_equals_1_ instanceof EffectInstance)) {
-         return false;
-      } else {
-         EffectInstance effectinstance = (EffectInstance)p_equals_1_;
-         return this.field_76460_b == effectinstance.field_76460_b && this.field_76461_c == effectinstance.field_76461_c && this.field_82723_d == effectinstance.field_82723_d && this.field_82724_e == effectinstance.field_82724_e && this.field_188420_b.equals(effectinstance.field_188420_b);
-      }
-   }
+		return s;
+	}
 
-   public int hashCode() {
-      int i = this.field_188420_b.hashCode();
-      i = 31 * i + this.field_76460_b;
-      i = 31 * i + this.field_76461_c;
-      i = 31 * i + (this.field_82723_d ? 1 : 0);
-      i = 31 * i + (this.field_82724_e ? 1 : 0);
-      return i;
-   }
+	public boolean equals(Object p_equals_1_) {
+		if (this == p_equals_1_) {
+			return true;
+		} else if (!(p_equals_1_ instanceof EffectInstance)) {
+			return false;
+		} else {
+			EffectInstance effectinstance = (EffectInstance) p_equals_1_;
+			return this.field_76460_b == effectinstance.field_76460_b && this.field_76461_c == effectinstance.field_76461_c
+					&& this.field_82723_d == effectinstance.field_82723_d && this.field_82724_e == effectinstance.field_82724_e
+					&& this.field_188420_b.equals(effectinstance.field_188420_b);
+		}
+	}
 
-   public CompoundNBT func_82719_a(CompoundNBT p_82719_1_) {
-      p_82719_1_.func_74774_a("Id", (byte)Effect.func_188409_a(this.func_188419_a()));
-      p_82719_1_.func_74774_a("Amplifier", (byte)this.func_76458_c());
-      p_82719_1_.func_74768_a("Duration", this.func_76459_b());
-      p_82719_1_.func_74757_a("Ambient", this.func_82720_e());
-      p_82719_1_.func_74757_a("ShowParticles", this.func_188418_e());
-      p_82719_1_.func_74757_a("ShowIcon", this.func_205348_f());
-      return p_82719_1_;
-   }
+	public int hashCode() {
+		int i = this.field_188420_b.get().hashCode();
+		i = 31 * i + this.field_76460_b;
+		i = 31 * i + this.field_76461_c;
+		i = 31 * i + (this.field_82723_d ? 1 : 0);
+		i = 31 * i + (this.field_82724_e ? 1 : 0);
+		return i;
+	}
 
-   public static EffectInstance func_82722_b(CompoundNBT p_82722_0_) {
-      int i = p_82722_0_.func_74771_c("Id");
-      Effect effect = Effect.func_188412_a(i);
-      if (effect == null) {
-         return null;
-      } else {
-         int j = p_82722_0_.func_74771_c("Amplifier");
-         int k = p_82722_0_.func_74762_e("Duration");
-         boolean flag = p_82722_0_.func_74767_n("Ambient");
-         boolean flag1 = true;
-         if (p_82722_0_.func_150297_b("ShowParticles", 1)) {
-            flag1 = p_82722_0_.func_74767_n("ShowParticles");
-         }
+	public CompoundNBT func_82719_a(CompoundNBT p_82719_1_) {
+		p_82719_1_.func_74774_a("Id", (byte) Effect.func_188409_a(this.func_188419_a()));
+		p_82719_1_.func_74774_a("Amplifier", (byte) this.func_76458_c());
+		p_82719_1_.func_74768_a("Duration", this.func_76459_b());
+		p_82719_1_.func_74757_a("Ambient", this.func_82720_e());
+		p_82719_1_.func_74757_a("ShowParticles", this.func_188418_e());
+		p_82719_1_.func_74757_a("ShowIcon", this.func_205348_f());
+		writeCurativeItems(p_82719_1_);
+		return p_82719_1_;
+	}
 
-         boolean flag2 = flag1;
-         if (p_82722_0_.func_150297_b("ShowIcon", 1)) {
-            flag2 = p_82722_0_.func_74767_n("ShowIcon");
-         }
+	public static EffectInstance func_82722_b(CompoundNBT p_82722_0_) {
+		int i = p_82722_0_.func_74771_c("Id") & 0xFF;
+		Effect effect = Effect.func_188412_a(i);
+		if (effect == null) {
+			return null;
+		} else {
+			int j = p_82722_0_.func_74771_c("Amplifier");
+			int k = p_82722_0_.func_74762_e("Duration");
+			boolean flag = p_82722_0_.func_74767_n("Ambient");
+			boolean flag1 = true;
+			if (p_82722_0_.func_150297_b("ShowParticles", 1)) {
+				flag1 = p_82722_0_.func_74767_n("ShowParticles");
+			}
 
-         return new EffectInstance(effect, k, j < 0 ? 0 : j, flag, flag1, flag2);
-      }
-   }
+			boolean flag2 = flag1;
+			if (p_82722_0_.func_150297_b("ShowIcon", 1)) {
+				flag2 = p_82722_0_.func_74767_n("ShowIcon");
+			}
 
-   @OnlyIn(Dist.CLIENT)
-   public void func_100012_b(boolean p_100012_1_) {
-      this.field_100013_f = p_100012_1_;
-   }
+			return readCurativeItems(new EffectInstance(effect, k, j < 0 ? 0 : j, flag, flag1, flag2), p_82722_0_);
+		}
+	}
 
-   @OnlyIn(Dist.CLIENT)
-   public boolean func_100011_g() {
-      return this.field_100013_f;
-   }
+	@OnlyIn(Dist.CLIENT)
+	public void func_100012_b(boolean p_100012_1_) {
+		this.field_100013_f = p_100012_1_;
+	}
 
-   public int compareTo(EffectInstance p_compareTo_1_) {
-      int i = 32147;
-      return (this.func_76459_b() <= 32147 || p_compareTo_1_.func_76459_b() <= 32147) && (!this.func_82720_e() || !p_compareTo_1_.func_82720_e()) ? ComparisonChain.start().compare(this.func_82720_e(), p_compareTo_1_.func_82720_e()).compare(this.func_76459_b(), p_compareTo_1_.func_76459_b()).compare(this.func_188419_a().func_76401_j(), p_compareTo_1_.func_188419_a().func_76401_j()).result() : ComparisonChain.start().compare(this.func_82720_e(), p_compareTo_1_.func_82720_e()).compare(this.func_188419_a().func_76401_j(), p_compareTo_1_.func_188419_a().func_76401_j()).result();
-   }
+	@OnlyIn(Dist.CLIENT)
+	public boolean func_100011_g() {
+		return this.field_100013_f;
+	}
+
+	public int compareTo(EffectInstance p_compareTo_1_) {
+		int i = 32147;
+		return (this.func_76459_b() <= 32147 || p_compareTo_1_.func_76459_b() <= 32147)
+				&& (!this.func_82720_e() || !p_compareTo_1_.func_82720_e())
+						? ComparisonChain.start().compare(this.func_82720_e(), p_compareTo_1_.func_82720_e())
+								.compare(this.func_76459_b(), p_compareTo_1_.func_76459_b())
+								.compare(this.func_188419_a().getGuiSortColor(this),
+										p_compareTo_1_.func_188419_a().getGuiSortColor(this))
+								.result()
+						: ComparisonChain.start().compare(this.func_82720_e(), p_compareTo_1_.func_82720_e())
+								.compare(this.func_188419_a().getGuiSortColor(this),
+										p_compareTo_1_.func_188419_a().getGuiSortColor(this))
+								.result();
+	}
+
+	// ======================= FORGE START ===========================
+	private java.util.List<net.minecraft.item.ItemStack> curativeItems;
+
+	@Override
+	public java.util.List<net.minecraft.item.ItemStack> getCurativeItems() {
+		if (this.curativeItems == null) // Lazy load this so that we don't create a circular dep on Items.
+			this.curativeItems = func_188419_a().getCurativeItems();
+		return this.curativeItems;
+	}
+
+	@Override
+	public void setCurativeItems(java.util.List<net.minecraft.item.ItemStack> curativeItems) {
+		this.curativeItems = curativeItems;
+	}
+
+	private static EffectInstance readCurativeItems(EffectInstance effect, CompoundNBT nbt) {
+		if (nbt.func_150297_b("CurativeItems", net.minecraftforge.common.util.Constants.NBT.TAG_LIST)) {
+			java.util.List<net.minecraft.item.ItemStack> items = new java.util.ArrayList<net.minecraft.item.ItemStack>();
+			net.minecraft.nbt.ListNBT list = nbt.func_150295_c("CurativeItems",
+					net.minecraftforge.common.util.Constants.NBT.TAG_COMPOUND);
+			for (int i = 0; i < list.size(); i++) {
+				items.add(net.minecraft.item.ItemStack.func_199557_a(list.func_150305_b(i)));
+			}
+			effect.setCurativeItems(items);
+		}
+
+		return effect;
+	}
 }
